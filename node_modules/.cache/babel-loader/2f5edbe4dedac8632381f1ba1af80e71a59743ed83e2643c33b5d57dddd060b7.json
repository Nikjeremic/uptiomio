{"ast":null,"code":"import axios from 'axios';\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'https://payments.uptimio.com/api';\nconst api = axios.create({\n  baseURL: API_BASE_URL\n});\nlet isRefreshing = false;\nlet failedQueue = [];\nconst processQueue = (error, token = null) => {\n  failedQueue.forEach(prom => {\n    if (error) {\n      prom.reject(error);\n    } else {\n      prom.resolve(token);\n    }\n  });\n  failedQueue = [];\n};\n\n// Add token to requests\napi.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\n// Auto-refresh token on 401/403\napi.interceptors.response.use(response => response, async error => {\n  var _error$response, _error$response2;\n  const originalRequest = error.config;\n\n  // If error is 401 or 403 and we haven't tried to refresh yet\n  if ((((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401 || ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.status) === 403) && !originalRequest._retry) {\n    if (isRefreshing) {\n      // If already refreshing, queue this request\n      return new Promise((resolve, reject) => {\n        failedQueue.push({\n          resolve,\n          reject\n        });\n      }).then(token => {\n        originalRequest.headers['Authorization'] = 'Bearer ' + token;\n        return api(originalRequest);\n      }).catch(err => Promise.reject(err));\n    }\n    originalRequest._retry = true;\n    isRefreshing = true;\n    const refreshToken = localStorage.getItem('refreshToken');\n    if (!refreshToken) {\n      // No refresh token - logout\n      localStorage.removeItem('token');\n      localStorage.removeItem('refreshToken');\n      window.location.href = '/';\n      return Promise.reject(error);\n    }\n    try {\n      // Try to refresh token\n      const response = await axios.post(`${API_BASE_URL}/refresh-token`, {\n        refreshToken\n      });\n      const {\n        token,\n        refreshToken: newRefreshToken\n      } = response.data;\n\n      // Save new tokens\n      localStorage.setItem('token', token);\n      localStorage.setItem('refreshToken', newRefreshToken);\n\n      // Update authorization header\n      api.defaults.headers.common['Authorization'] = 'Bearer ' + token;\n      originalRequest.headers['Authorization'] = 'Bearer ' + token;\n      processQueue(null, token);\n      isRefreshing = false;\n\n      // Retry original request\n      return api(originalRequest);\n    } catch (refreshError) {\n      // Refresh failed - logout\n      processQueue(refreshError, null);\n      isRefreshing = false;\n      localStorage.removeItem('token');\n      localStorage.removeItem('refreshToken');\n      window.location.href = '/';\n      return Promise.reject(refreshError);\n    }\n  }\n  return Promise.reject(error);\n});\nexport const authAPI = {\n  login: (email, password) => api.post('/login', {\n    email,\n    password\n  }),\n  register: (name, email, password, role) => api.post('/register', {\n    name,\n    email,\n    password,\n    role\n  }),\n  logout: () => api.post('/logout'),\n  refreshToken: refreshToken => api.post('/refresh-token', {\n    refreshToken\n  })\n};\nexport const profileAPI = {\n  get: () => api.get('/profile'),\n  update: data => api.put('/profile', data),\n  getByUserId: userId => api.get(`/users/${userId}/profile`),\n  updateByUserId: (userId, data) => api.put(`/users/${userId}/profile`, data),\n  uploadLogo: file => {\n    const form = new FormData();\n    form.append('file', file);\n    return api.post('/profile/logo', form, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n  },\n  uploadSignature: file => {\n    const form = new FormData();\n    form.append('file', file);\n    return api.post('/profile/signature', form, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n  },\n  uploadLogoForUser: (userId, file) => {\n    const form = new FormData();\n    form.append('file', file);\n    return api.post(`/users/${userId}/profile/logo`, form, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n  }\n};\nexport const invoiceAPI = {\n  getAllInvoices: search => api.get('/invoices', {\n    params: search ? {\n      search\n    } : undefined\n  }),\n  getMyInvoices: search => api.get('/my-invoices', {\n    params: search ? {\n      search\n    } : undefined\n  }),\n  getById: id => api.get(`/invoices/${id}`),\n  createInvoice: invoiceData => api.post('/invoices', invoiceData),\n  markAsPaid: (id, paymentMethod) => api.patch(`/invoices/${id}/pay`, {\n    paymentMethod\n  }),\n  deleteById: id => api.delete(`/invoices/${id}`)\n};\nexport const userAPI = {\n  getAllUsers: () => api.get('/users'),\n  createUser: (name, email, password, role, profile) => api.post('/users', {\n    name,\n    email,\n    password,\n    role,\n    profile\n  }),\n  deleteUser: id => api.delete(`/users/${id}`),\n  resetPassword: (id, customPassword) => api.post(`/users/${id}/reset-password`, {\n    customPassword\n  })\n};\nexport default api;","map":{"version":3,"names":["axios","API_BASE_URL","process","env","REACT_APP_API_BASE_URL","api","create","baseURL","isRefreshing","failedQueue","processQueue","error","token","forEach","prom","reject","resolve","interceptors","request","use","config","localStorage","getItem","headers","Authorization","response","_error$response","_error$response2","originalRequest","status","_retry","Promise","push","then","catch","err","refreshToken","removeItem","window","location","href","post","newRefreshToken","data","setItem","defaults","common","refreshError","authAPI","login","email","password","register","name","role","logout","profileAPI","get","update","put","getByUserId","userId","updateByUserId","uploadLogo","file","form","FormData","append","uploadSignature","uploadLogoForUser","invoiceAPI","getAllInvoices","search","params","undefined","getMyInvoices","getById","id","createInvoice","invoiceData","markAsPaid","paymentMethod","patch","deleteById","delete","userAPI","getAllUsers","createUser","profile","deleteUser","resetPassword","customPassword"],"sources":["/home/nikjeremic/Desktop/uptiomio/src/services/api.ts"],"sourcesContent":["import axios from 'axios';\nimport { UserRole } from '../types';\n\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'https://payments.uptimio.com/api';\n\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n});\n\nlet isRefreshing = false;\nlet failedQueue: any[] = [];\n\nconst processQueue = (error: any, token: string | null = null) => {\n  failedQueue.forEach(prom => {\n    if (error) {\n      prom.reject(error);\n    } else {\n      prom.resolve(token);\n    }\n  });\n  failedQueue = [];\n};\n\n// Add token to requests\napi.interceptors.request.use((config) => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    (config.headers as any).Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\n// Auto-refresh token on 401/403\napi.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    const originalRequest = error.config;\n\n    // If error is 401 or 403 and we haven't tried to refresh yet\n    if ((error.response?.status === 401 || error.response?.status === 403) && !originalRequest._retry) {\n      if (isRefreshing) {\n        // If already refreshing, queue this request\n        return new Promise((resolve, reject) => {\n          failedQueue.push({ resolve, reject });\n        })\n          .then(token => {\n            originalRequest.headers['Authorization'] = 'Bearer ' + token;\n            return api(originalRequest);\n          })\n          .catch(err => Promise.reject(err));\n      }\n\n      originalRequest._retry = true;\n      isRefreshing = true;\n\n      const refreshToken = localStorage.getItem('refreshToken');\n\n      if (!refreshToken) {\n        // No refresh token - logout\n        localStorage.removeItem('token');\n        localStorage.removeItem('refreshToken');\n        window.location.href = '/';\n        return Promise.reject(error);\n      }\n\n      try {\n        // Try to refresh token\n        const response = await axios.post(`${API_BASE_URL}/refresh-token`, { refreshToken });\n        const { token, refreshToken: newRefreshToken } = response.data;\n\n        // Save new tokens\n        localStorage.setItem('token', token);\n        localStorage.setItem('refreshToken', newRefreshToken);\n\n        // Update authorization header\n        api.defaults.headers.common['Authorization'] = 'Bearer ' + token;\n        originalRequest.headers['Authorization'] = 'Bearer ' + token;\n\n        processQueue(null, token);\n        isRefreshing = false;\n\n        // Retry original request\n        return api(originalRequest);\n      } catch (refreshError) {\n        // Refresh failed - logout\n        processQueue(refreshError, null);\n        isRefreshing = false;\n        \n        localStorage.removeItem('token');\n        localStorage.removeItem('refreshToken');\n        window.location.href = '/';\n        \n        return Promise.reject(refreshError);\n      }\n    }\n\n    return Promise.reject(error);\n  }\n);\n\nexport const authAPI = {\n  login: (email: string, password: string) =>\n    api.post('/login', { email, password }),\n  register: (name: string, email: string, password: string, role?: string) =>\n    api.post('/register', { name, email, password, role }),\n  logout: () => api.post('/logout'),\n  refreshToken: (refreshToken: string) => \n    api.post('/refresh-token', { refreshToken }),\n};\n\nexport const profileAPI = {\n  get: () => api.get('/profile'),\n  update: (data: any) => api.put('/profile', data),\n  getByUserId: (userId: string) => api.get(`/users/${userId}/profile`),\n  updateByUserId: (userId: string, data: any) => api.put(`/users/${userId}/profile`, data),\n  uploadLogo: (file: File) => {\n    const form = new FormData();\n    form.append('file', file);\n    return api.post('/profile/logo', form, { headers: { 'Content-Type': 'multipart/form-data' } });\n  },\n  uploadSignature: (file: File) => {\n    const form = new FormData();\n    form.append('file', file);\n    return api.post('/profile/signature', form, { headers: { 'Content-Type': 'multipart/form-data' } });\n  },\n  uploadLogoForUser: (userId: string, file: File) => {\n    const form = new FormData();\n    form.append('file', file);\n    return api.post(`/users/${userId}/profile/logo`, form, { headers: { 'Content-Type': 'multipart/form-data' } });\n  }\n};\n\nexport const invoiceAPI = {\n  getAllInvoices: (search?: string) => api.get('/invoices', { params: search ? { search } : undefined }),\n  getMyInvoices: (search?: string) => api.get('/my-invoices', { params: search ? { search } : undefined }),\n  getById: (id: string) => api.get(`/invoices/${id}`),\n  createInvoice: (invoiceData: any) => api.post('/invoices', invoiceData),\n  markAsPaid: (id: string, paymentMethod: string) =>\n    api.patch(`/invoices/${id}/pay`, { paymentMethod }),\n  deleteById: (id: string) => api.delete(`/invoices/${id}`)\n};\n\nexport const userAPI = {\n  getAllUsers: () => api.get('/users'),\n  createUser: (name: string, email: string, password: string, role: UserRole, profile?: any) =>\n    api.post('/users', { name, email, password, role, profile }),\n  deleteUser: (id: string) => api.delete(`/users/${id}`),\n  resetPassword: (id: string, customPassword?: string) => \n    api.post(`/users/${id}/reset-password`, { customPassword })\n};\n\nexport default api;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}